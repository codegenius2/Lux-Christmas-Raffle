{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rami/Documents/Dev/LUX : Metalyde/Mintpage/Metakyde-Lux/Metalyde-Lux-Christmas-Raffle/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/rami/Documents/Dev/LUX : Metalyde/Mintpage/Metakyde-Lux/Metalyde-Lux-Christmas-Raffle/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/rami/Documents/Dev/LUX : Metalyde/Mintpage/Metakyde-Lux/Metalyde-Lux-Christmas-Raffle/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useReducer,useCallback,useEffect}from\"react\";import Web3 from\"web3\";import EthContext from\"./EthContext\";import{reducer,actions,initialState}from\"./state\";import{jsx as _jsx}from\"react/jsx-runtime\";function EthProvider(_ref){var children=_ref.children;var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var init=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(artifact){var web3,accounts,networkID,abi,address,contract,isOwner,isMintOn,mintPrice,mintState,mintPriceData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!artifact){_context.next=27;break;}web3=new Web3(Web3.givenProvider||\"ws://localhost:8545\");_context.next=4;return web3.eth.requestAccounts();case 4:accounts=_context.sent;_context.next=7;return web3.eth.net.getId();case 7:networkID=_context.sent;abi=artifact.abi;_context.prev=9;address=artifact.networks[networkID].address;contract=new web3.eth.Contract(abi,address);// const owner = await contract.methods.owner().call();\n// if (accounts[0] === owner) {\n//   isOwner = true;\n// }\nisOwner=false;_context.next=15;return contract.methods.isMintOn().call();case 15:mintState=_context.sent;if(mintState===true){isMintOn=true;}else{isMintOn=false;}_context.next=19;return contract.methods.checkPrice().call();case 19:mintPriceData=_context.sent;mintPrice=mintPriceData;_context.next=26;break;case 23:_context.prev=23;_context.t0=_context[\"catch\"](9);console.error(_context.t0);case 26:dispatch({type:actions.init,data:{artifact:artifact,web3:web3,accounts:accounts,networkID:networkID,contract:contract,isOwner:isOwner,isMintOn:isMintOn,mintPrice:mintPrice}});case 27:case\"end\":return _context.stop();}}},_callee,null,[[9,23]]);}));return function(_x){return _ref2.apply(this,arguments);};}(),[]);useEffect(function(){var tryInit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var artifact;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:try{artifact=require(\"../../contracts/Nft.json\");init(artifact);}catch(err){console.error(err);}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function tryInit(){return _ref3.apply(this,arguments);};}();tryInit();},[init]);useEffect(function(){var events=[\"chainChanged\",\"accountsChanged\"];var handleChange=function handleChange(){init(state.artifact);};events.forEach(function(e){return window.ethereum.on(e,handleChange);});return function(){events.forEach(function(e){return window.ethereum.removeListener(e,handleChange);});};},[init,state.artifact]);return/*#__PURE__*/_jsx(EthContext.Provider,{value:{state:state,dispatch:dispatch},children:children});}export default EthProvider;","map":{"version":3,"names":["React","useReducer","useCallback","useEffect","Web3","EthContext","reducer","actions","initialState","EthProvider","children","state","dispatch","init","artifact","web3","givenProvider","eth","requestAccounts","accounts","net","getId","networkID","abi","address","networks","contract","Contract","isOwner","methods","isMintOn","call","mintState","checkPrice","mintPriceData","mintPrice","console","error","type","data","tryInit","require","err","events","handleChange","forEach","e","window","ethereum","on","removeListener"],"sources":["/Users/rami/Documents/Dev/LUX : Metalyde/Mintpage/Metakyde-Lux/Metalyde-Lux-Christmas-Raffle/client/src/contexts/EthContext/EthProvider.jsx"],"sourcesContent":["import React, { useReducer, useCallback, useEffect } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\n\nfunction EthProvider({ children }) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const init = useCallback(\n    async artifact => {\n      if (artifact) {\n        const web3 = new Web3(Web3.givenProvider || \"ws://localhost:8545\");\n        const accounts = await web3.eth.requestAccounts();\n        const networkID = await web3.eth.net.getId();\n        const { abi } = artifact;\n        let address, contract, isOwner, isMintOn, mintPrice;\n        try {\n          address = artifact.networks[networkID].address;\n          contract = new web3.eth.Contract(abi, address);\n          // const owner = await contract.methods.owner().call();\n          // if (accounts[0] === owner) {\n          //   isOwner = true;\n          // }\n          isOwner= false;\n          const mintState = await contract.methods.isMintOn().call();\n          if (mintState === true) {\n            isMintOn = true;\n          } else {\n            isMintOn = false\n          }\n          const mintPriceData = await contract.methods.checkPrice().call();\n          mintPrice = mintPriceData;\n        } catch (err) {\n          console.error(err);\n        }\n        dispatch({\n          type: actions.init,\n          data: { artifact, web3, accounts, networkID, contract, isOwner, isMintOn, mintPrice }\n        });\n      }\n    }, []);\n\n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/Nft.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    tryInit();\n  }, [init]);\n\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n    };\n\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n    };\n  }, [init, state.artifact]);\n\n  return (\n    <EthContext.Provider value={{\n      state,\n      dispatch\n    }}>\n      {children}\n    </EthContext.Provider>\n  );\n}\n\nexport default EthProvider;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}